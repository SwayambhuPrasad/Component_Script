{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/assets/MCQ/script/MCQ.ts"],"names":["Button","Component","find","instantiate","Label","Layout","Prefab","_decorator","AS","UIView","ReplicatedButton","UIAnimationLibrary","debug","ValidationEvent","ChangeBackground","ccclass","property","requireComponent","AnswerType","MCQ","type","Number","String","Boolean","backGround","_selection","Array","store","awake","on","_setNavStatus","bind","createRuntimeOption","insertChild","insertButtonsComp","optionsContainer","node","children","choiceButtons","map","child","btn","addComponent","EventType","CLICK","checkSelection","forEach","i","push","SingleAns","active","getComponent","ButtonClick","play","lableAssigner","onEnable","_navButtonVisibility","screen","ScreenTag","console","log","_callToVisible","Screen","optionLabel","length","addchild","optionPrefab","parent","isCorrect","reduce","check","isSelected","answer","checkFeedback","getComponentInChildren","CheckPrompt","showCorrect","Checkrompt","showTryAgain","ev","dispatchEvent","mcqLable","getComponentsInChildren","btnLable","string","statusIndex","Promise","all","status","flash"],"mappings":"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","sourcesContent":["import { Button, Canvas, Component, find, instantiate, Label, Layout, Prefab, _decorator,Node, EventHandler ,Event, SpriteFrame, bits} from \"cc\";\nimport { AS, UIView } from \"db://as_framework/scripts\";\nimport { ReplicatedButton } from \"db://as_framework/scripts\";\nimport { UIAnimationLibrary } from \"db://as_framework/scripts/UIAnimLibrary\";\nimport { debug } from \"db://as_framework/scripts\";\n\nimport { ValidationEvent } from \"../../ValidationEvent\";\nimport { ChangeBackground } from \"../../Background/ChangeBackground\";\nconst { ccclass, property, requireComponent } = _decorator;\n\nenum AnswerType {\n  SINGLE_CORRECT,\n  MULTIPLE_CORRECT,\n}\n\n@ccclass(\"MCQ\")\nexport class MCQ extends AS(Component) {\n\n  private backGround: Node = null;\n\n  @property({type:Number}) ScreenTag: Number = -1;\n\n  @property({ type: String }) private optionLabel: string[] = [];\n\n  @property(Prefab) private optionPrefab: Prefab = null;\n\n  //@property(SpriteFrame) private optionSprite: SpriteFrame[] = [];\n\n  @property(Layout) private optionsContainer: Layout | null = null;\n\n  //@property({type: Enum(AnswerType)}) private answerType = AnswerType.SINGLE_CORRECT;\n\n  // @property({visible: function (this: MCQ) {return this.answerType === AnswerType.SINGLE_CORRECT}}) private x;\n  private _selection = Array<boolean>();\n\n  @property({ type: Boolean })  private answer = [];\n\n  @property({ type: Boolean }) private createRuntimeOption = true;\n\n  @property private changeColorAsFeedback= true;\n\n  @property private SingleAns= true;\n\n  private store=-1;\n\n\n  //private ChangeBackground;\n\n  awake() {\n     this.backGround= find(\"Canvas_new/BackGround\");\n    this.backGround.on(\"Screen\",this._setNavStatus.bind(this));\n\n    // const BackGround=new  ChangeBackground\n    // BackGround.node.on(\"Screen\",this._setNavStatus.bind(this,BackGround))\n\n    if(this.createRuntimeOption)this.insertChild();\n\n    const insertButtonsComp = this.optionsContainer.node.children;\n\n    const choiceButtons = insertButtonsComp.map((child) => {\n      const btn = child.addComponent(Button);\n      child.addComponent(ReplicatedButton);\n      return btn;\n    });\n    this.node.children[1].addComponent(Button);\n    this.node.children[1].addComponent(ReplicatedButton);\n    this.node.children[1].addComponent(UIView);\n    this.node.children[1].on(Button.EventType.CLICK, () => {\n      this.checkSelection();\n    });\n    choiceButtons.forEach((btn, i) => {\n      this._selection.push(false);\n\n      btn.node.on(Button.EventType.CLICK, async () => {\n        if(this.SingleAns)\n        if(this.store!=-1)\n        {\n          choiceButtons[this.store].node.children[0].active = false;\n          this._selection[this.store] = false;\n        }\n        this.store=i\n        this.backGround.getComponent(ChangeBackground).ButtonClick.play();\n        if (this._selection[i] === false) {\n          btn.node.children[0].active = true;\n          this._selection[i] = true;\n        } else {\n          btn.node.children[0].active = false;\n          this._selection[i] = false;\n        }\n      });\n    });\n    this.lableAssigner();\n\n  }\n\n  onEnable(){\n    this.backGround.getComponent(ChangeBackground)._navButtonVisibility(false,false,false)\n  }\n  // onDisable(){\n  //   this.backGround.getComponent(ChangeBackground)._navButtonVisibility(false,true,false)\n  // }\n\n  _setNavStatus(screen){\n    if(this.ScreenTag==screen){\n      console.log(\"set\",screen)\n      this.backGround.getComponent(ChangeBackground)._navButtonVisibility(false,true,false)\n    }\n  }\n\n\n\n  _callToVisible(Screen){\n    if(this.ScreenTag == Screen) this.node.active=true;\n    else if(this.ScreenTag==-1) return;\n    else this.node.active=false;\n  }\n\n  insertChild() {\n    for (let i = 0; i < this.optionLabel.length; i++) {\n      let addchild = instantiate(this.optionPrefab);\n      addchild.parent = this.optionsContainer.node;\n    }\n  }\n\n async checkSelection() {\n  this.backGround.getComponent(ChangeBackground).ButtonClick.play();\n    const isCorrect = this._selection.reduce((check, isSelected, i) => {\n      check &&= isSelected === this.answer[i]\n      return check;\n    }, true);\n\n    this.checkFeedback(isCorrect ? 1: 2);\n    this.node.children[1].active=false;\n    if(isCorrect)\n    await this.backGround.getComponentInChildren(CheckPrompt).showCorrect();\n    else await this.backGround.getComponentInChildren(Checkrompt).showTryAgain();\n    this.node.children[1].active=true;\n    const ev = new ValidationEvent(true, isCorrect)\n    this.node.dispatchEvent(ev)\n    debug(\"Dispatched event - \", ev)\n  }\n\n  lableAssigner() {\n    const mcqLable = this.node.getComponentsInChildren(Label);\n    mcqLable.forEach((btnLable, i) => {\n      if (this.optionLabel.length <= i) {\n        btnLable.node.parent.active = false;\n      } else btnLable.string = this.optionLabel[i];\n    });\n  }\n\n  async checkFeedback(statusIndex) {\n    const btn = this.optionsContainer.node.children;\n    await Promise.all(\n      this._selection.map(async (status, i) => {\n        if (status) {\n          btn[i].children[statusIndex].active = true;\n          await UIAnimationLibrary.flash(btn[i].children[statusIndex], 2);\n          btn[i].children[statusIndex].active = false;\n        }\n      }),\n    );\n  }\n}\n"]}