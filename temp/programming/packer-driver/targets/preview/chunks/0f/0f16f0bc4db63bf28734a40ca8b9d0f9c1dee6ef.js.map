{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/extensions/as_framework/framework/assets/scripts/UIDrag.ts"],"names":["Component","EventHandler","Intersection2D","Mat4","Node","PolygonCollider2D","rect","UITransform","v2","v3","Vec2","Vec3","_decorator","AS","UIDrop","findParentCanvas","ccclass","property","disallowMultiple","requireComponent","DRAG_SPEED","matrixCached","worldMatrixCached","UIDrag","type","tooltip","displayOrder","_thisUITransform","_targetPosition","_validUIDrop","_resetPosition","_lerpTime","_parentCanvas","_canvasCamera","_collider","_isBeginValid","_actualParent","_isDragging","interactable","_interactable","enableResetPosition","_enableResetPosition","target","_target","usePolygonCollider","_usePolygonCollider","targetPosition","resetScreenPoint","validUIDrop","checkUIDrop","value","_addInputListeners","_removeInputListeners","__removeDrag","reset","forceSetPosition","resetDrop","_setTargetPositionInternal","position","node","worldPosition","_checkUIDropInternal","x","y","onLoad","getComponent","cameraComponent","onEnable","on","EventType","PARENT_CHANGED","_onParentChanged","onDisable","off","update","dt","currPosition","equals","lerp","awake","clone","TOUCH_START","_onTouchStart","TOUCH_MOVE","_onTouchMove","TOUCH_END","_onTouchEnd","TOUCH_CANCEL","parent","event","mouseWorld","screenToWorld","getLocationX","getLocationY","pointInPolygon","worldPoints","emitEvents","dragDidBeganEvents","emit","DRAG_DID_BEGAN","_getTargetBounds","contains","enableSnap","dragDidEndedEvents","DRAG_DID_END","touchLocation","enabledInHierarchy","oldUIDrop","getComponentsInChildren","find","uiDrop","__isInside","boundsType","BoundsType","CIRCLE","radius","circleRadius","center","dragBounds","getBoundingBoxToWorld","distances","distance","xMin","yMin","yMax","xMax","some","curr","__addDrag","dragMoveEvents","DRAG_MOVE","fromRTS","getRotation","getPosition","getScale","width","contentSize","height","localRect","anchorPoint","getWorldMatrix","multiply","transformMat4","Array"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGEA,MAAAA,S,OAAAA,S;AACAC,MAAAA,Y,OAAAA,Y;AAEAC,MAAAA,c,OAAAA,c;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,iB,OAAAA,iB;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,W,OAAAA,W;AACAC,MAAAA,E,OAAAA,E;AACAC,MAAAA,E,OAAAA,E;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,I,OAAAA,I;AACAC,MAAAA,U,OAAAA,U;;AAEOC,MAAAA,E,iBAAAA,E;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,gB,iBAAAA,gB;;;;;;;OAEH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA,QAAX;AAAqBC,QAAAA,gBAArB;AAAuCC,QAAAA;AAAvC,O,GAA4DP,U;AAE5DQ,MAAAA,U,GAAa,G;AACbC,MAAAA,Y,GAAe,IAAIlB,IAAJ,E;AACfmB,MAAAA,iB,GAAoB,IAAInB,IAAJ,E;;wBAKboB,M,WAHZP,OAAO,CAAC,QAAD,C,UAEPG,gBAAgB,CAACZ,WAAD,C,UAQdU,QAAQ,CAAC;AACRO,QAAAA,IAAI,EAAE,CAACvB,YAAD,CADE;AAERwB,QAAAA,OAAO,EAAE,qDAFD;AAGRC,QAAAA,YAAY,EAAE;AAHN,OAAD,C,UAORT,QAAQ,CAAC;AACRO,QAAAA,IAAI,EAAE,CAACvB,YAAD,CADE;AAERwB,QAAAA,OAAO,EAAE,mDAFD;AAGRC,QAAAA,YAAY,EAAE;AAHN,OAAD,C,UAORT,QAAQ,CAAC;AACRO,QAAAA,IAAI,EAAE,CAACvB,YAAD,CADE;AAERwB,QAAAA,OAAO,EAAE,sEAFD;AAGRC,QAAAA,YAAY,EAAE;AAHN,OAAD,C,UAyCRT,QAAQ,CAAC;AAAEQ,QAAAA,OAAO,EAAE;AAAX,OAAD,C,UAKRR,QAAQ,CAAC;AACRO,QAAAA,IAAI,EAAEjB,WADE;AAERkB,QAAAA,OAAO,EACL,0FACA;AAJM,OAAD,C,gBArEVP,gB,+CADD,MAGaK,MAHb,SAG4B;AAAA;AAAA,oBAAGvB,SAAH,CAH5B,CAG0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAoChC2B,gBApCgC,GAoCO,IApCP;AAAA,eAsChCC,eAtCgC,GAsCRnB,EAAE,EAtCM;AAAA,eAwChCoB,YAxCgC,GAwCU,IAxCV;AAAA,eA0ChCC,cA1CgC,GA0CTrB,EAAE,EA1CO;AAAA,eA4ChCsB,SA5CgC,GA4CpB,CA5CoB;AAAA,eA8ChCC,aA9CgC,GA8CD,IA9CC;AAAA,eAgDhCC,aAhDgC,GAgDD,IAhDC;AAAA,eAkDhCC,SAlDgC,GAkDM,IAlDN;AAAA,eAoDhCC,aApDgC,GAoDhB,KApDgB;AAAA,eAsDhCC,aAtDgC,GAsDH,IAtDG;AAAA,eAwDhCC,WAxDgC,GAwDlB,KAxDkB;AAAA;;AA0Dd,YAAZC,YAAY,GAAG;AAC3B,iBAAO,KAAKC,aAAZ;AACD;;AAGsB,YAAnBC,mBAAmB,GAAG;AACxB,iBAAO,KAAKC,oBAAZ;AACD;;AAQS,YAANC,MAAM,GAAuB;AAC/B,iBAAO,KAAKC,OAAZ;AACD;;AAE+B,YAAlBC,kBAAkB,GAAG;AACjC,iBAAO,KAAKC,mBAAZ;AACD;;AAEiB,YAAdC,cAAc,GAAG;AACnB,iBAAO,KAAKlB,eAAZ;AACD;;AAEmB,YAAhBmB,gBAAgB,GAAG;AACrB,iBAAO,KAAKjB,cAAZ;AACD;;AAEc,YAAXkB,WAAW,GAAG;AAChB,iBAAO,KAAKC,WAAL,EAAP;AACD;;AAEe,YAAZX,YAAY,CAACY,KAAD,EAAQ;AACtB,cAAI,KAAKX,aAAL,KAAuBW,KAA3B,EAAkC;AAClC,eAAKX,aAAL,GAAqBW,KAArB;AAEA,cAAI,KAAKX,aAAT,EAAwB,KAAKY,kBAAL,GAAxB,KACK,KAAKC,qBAAL;AACN;;AAEsB,YAAnBZ,mBAAmB,CAACU,KAAD,EAAQ;AAC7B,eAAKT,oBAAL,GAA4BS,KAA5B;AACD;;AAES,YAANR,MAAM,CAACQ,KAAD,EAA4B;AACpC,eAAKP,OAAL,GAAeO,KAAf;AACD;;AAEqB,YAAlBN,kBAAkB,CAACM,KAAD,EAAQ;AAC5B,eAAKL,mBAAL,GAA2BK,KAA3B;AACD;;AAEiB,YAAdJ,cAAc,CAACI,KAAD,EAAc;AAAA;;AAC9B,eAAKnB,SAAL,GAAiB,CAAjB;AACA,eAAKH,eAAL,GAAuBsB,KAAvB;AAEA,qCAAKrB,YAAL,wCAAmBwB,YAAnB,CAAgC,IAAhC;AACA,eAAKxB,YAAL,GAAoB,IAApB;AACD;;AAEmB,YAAhBkB,gBAAgB,CAACG,KAAD,EAAc;AAChC,eAAKpB,cAAL,GAAsBoB,KAAtB;AACD;;AAEDI,QAAAA,KAAK,GAAG;AAAA;;AACN,cAAI,KAAKxB,cAAT,EAAyB;AACvB,iBAAKyB,gBAAL,CAAsB,KAAKzB,cAA3B;AACD;;AAED,sCAAKD,YAAL,yCAAmBwB,YAAnB,CAAgC,IAAhC;AACA,eAAKxB,YAAL,GAAoB,IAApB;AACD;;AAED2B,QAAAA,SAAS,GAAG;AAAA;;AACV,sCAAK3B,YAAL,yCAAmBwB,YAAnB,CAAgC,IAAhC;AACA,eAAKxB,YAAL,GAAoB,IAApB;;AACA,cAAI,KAAKC,cAAT,EAAyB;AACvB,iBAAK2B,0BAAL,CAAgC,KAAK3B,cAArC;AACD;AACF;;AAEDyB,QAAAA,gBAAgB,CAACG,QAAD,EAAiB;AAAA;;AAC/B,cAAIA,QAAQ,IAAI,IAAhB,EAAsB;AACtB,eAAK9B,eAAL,GAAuB8B,QAAvB;AACA,eAAKC,IAAL,CAAUC,aAAV,GAA0BF,QAA1B;AACA,sCAAK7B,YAAL,yCAAmBwB,YAAnB,CAAgC,IAAhC;AACA,eAAKxB,YAAL,GAAoB,IAApB;AACD;;AAEDoB,QAAAA,WAAW,GAAG;AACZ,eAAKY,oBAAL,CAA0BrD,EAAE,CAAC,KAAKsC,cAAL,CAAoBgB,CAArB,EAAwB,KAAKhB,cAAL,CAAoBiB,CAA5C,CAA5B,EADY,CAGZ;;;AAEA,iBAAO,KAAKlC,YAAZ;AACD;;AAEDmC,QAAAA,MAAM,GAAG;AACP,eAAKrC,gBAAL,GAAwB,KAAKsC,YAAL,CAAkB1D,WAAlB,CAAxB;AACA,eAAKyB,aAAL,GAAqB;AAAA;AAAA,oDAAiB,KAAK2B,IAAtB,CAArB;AACA,cAAI,KAAK3B,aAAL,IAAsB,IAA1B,EAAgC;AAChC,eAAKC,aAAL,GAAqB,KAAKD,aAAL,CAAmBkC,eAAxC;;AACA,cAAI,KAAKxB,MAAL,IAAe,IAAnB,EAAyB;AACvB,iBAAKA,MAAL,GAAc,KAAKV,aAAL,CAAmBiC,YAAnB,CAAgC1D,WAAhC,CAAd;AACD;;AACD,eAAK2B,SAAL,GAAiB,KAAK+B,YAAL,CAAkB5D,iBAAlB,CAAjB;AACD;;AAED8D,QAAAA,QAAQ,GAAG;AACT,cAAI,KAAK5B,aAAT,EAAwB,KAAKY,kBAAL;AACxB,eAAKQ,IAAL,CAAUS,EAAV,CAAahE,IAAI,CAACiE,SAAL,CAAeC,cAA5B,EAA4C,KAAKC,gBAAjD,EAAmE,IAAnE;;AACA,eAAKA,gBAAL;AACD;;AAEDC,QAAAA,SAAS,GAAG;AACV,eAAKpB,qBAAL;;AACA,eAAKO,IAAL,CAAUc,GAAV,CAAcrE,IAAI,CAACiE,SAAL,CAAeC,cAA7B,EAA6C,KAAKC,gBAAlD,EAAoE,IAApE;AACD;;AAEDG,QAAAA,MAAM,CAACC,EAAD,EAAa;AACjB,cAAMC,YAAY,GAAG,KAAKjB,IAAL,CAAUC,aAA/B;AACA,cAAIjD,IAAI,CAACkE,MAAL,CAAYD,YAAZ,EAA0B,KAAKhD,eAA/B,CAAJ,EAAqD;AACrD,eAAKG,SAAL,IAAkBX,UAAU,GAAGuD,EAA/B;AACA,cAAI,KAAK5C,SAAL,GAAiB,CAArB,EAAwB,KAAKA,SAAL,GAAiB,CAAjB;AACxB,eAAK4B,IAAL,CAAUC,aAAV,GAA0BgB,YAAY,CAACE,IAAb,CAAkB,KAAKlD,eAAvB,EAAwC,KAAKG,SAA7C,CAA1B;AACD;;AAEDgD,QAAAA,KAAK,GAAG;AACN;AACA,eAAKnD,eAAL,GAAuB,KAAK+B,IAAL,CAAUC,aAAV,CAAwBoB,KAAxB,EAAvB;AACA,eAAKlD,cAAL,GAAsB,KAAK6B,IAAL,CAAUC,aAAV,CAAwBoB,KAAxB,EAAtB;AACD;;AAEO7B,QAAAA,kBAAkB,GAAG;AAC3B,eAAKQ,IAAL,CAAUS,EAAV,CAAahE,IAAI,CAACiE,SAAL,CAAeY,WAA5B,EAAyC,KAAKC,aAA9C,EAA6D,IAA7D;AACA,eAAKvB,IAAL,CAAUS,EAAV,CAAahE,IAAI,CAACiE,SAAL,CAAec,UAA5B,EAAwC,KAAKC,YAA7C,EAA2D,IAA3D;AACA,eAAKzB,IAAL,CAAUS,EAAV,CAAahE,IAAI,CAACiE,SAAL,CAAegB,SAA5B,EAAuC,KAAKC,WAA5C,EAAyD,IAAzD;AACA,eAAK3B,IAAL,CAAUS,EAAV,CAAahE,IAAI,CAACiE,SAAL,CAAekB,YAA5B,EAA0C,KAAKD,WAA/C,EAA4D,IAA5D;AACD;;AAEOlC,QAAAA,qBAAqB,GAAG;AAC9B,eAAKO,IAAL,CAAUc,GAAV,CAAcrE,IAAI,CAACiE,SAAL,CAAeY,WAA7B,EAA0C,KAAKC,aAA/C,EAA8D,IAA9D;AACA,eAAKvB,IAAL,CAAUc,GAAV,CAAcrE,IAAI,CAACiE,SAAL,CAAec,UAA7B,EAAyC,KAAKC,YAA9C,EAA4D,IAA5D;AACA,eAAKzB,IAAL,CAAUc,GAAV,CAAcrE,IAAI,CAACiE,SAAL,CAAegB,SAA7B,EAAwC,KAAKC,WAA7C,EAA0D,IAA1D;AACA,eAAK3B,IAAL,CAAUc,GAAV,CAAcrE,IAAI,CAACiE,SAAL,CAAekB,YAA7B,EAA2C,KAAKD,WAAhD,EAA6D,IAA7D;AACD;;AAEOf,QAAAA,gBAAgB,GAAG;AACzB,cAAI,KAAKlC,WAAT,EAAsB;AACtB,eAAKD,aAAL,GAAqB,KAAKuB,IAAL,CAAU6B,MAA/B;AACD;;AAEON,QAAAA,aAAa,CAACO,KAAD,EAAoB;AACvC,cAAI,KAAKxD,aAAL,IAAsB,IAAtB,IAA8B,KAAKD,aAAL,IAAsB,IAAxD,EAA8D;;AAC9D,cAAM0D,UAAU,GAAG,KAAKzD,aAAL,CAAmB0D,aAAnB,CACjBlF,EAAE,CAACgF,KAAK,CAACG,YAAN,EAAD,EAAuBH,KAAK,CAACI,YAAN,EAAvB,CADe,CAAnB;;AAGA,cAAI,KAAKhD,mBAAL,IAA4B,KAAKX,SAArC,EAAgD;AAC9C,iBAAKC,aAAL,GAAqBjC,cAAc,CAAC4F,cAAf,CACnBtF,EAAE,CAACkF,UAAU,CAAC5B,CAAZ,EAAe4B,UAAU,CAAC3B,CAA1B,CADiB,EAEnB,KAAK7B,SAAL,CAAe6D,WAFI,CAArB;AAID,WALD,MAKO;AACL,iBAAK5D,aAAL,GAAqB,IAArB;AACD;;AAED,eAAKE,WAAL,GAAmB,IAAnB;AACA,eAAKsB,IAAL,CAAU6B,MAAV,GAAmB,KAAKxD,aAAL,CAAmB2B,IAAtC;AACA1D,UAAAA,YAAY,CAAC+F,UAAb,CAAwB,KAAKC,kBAA7B,EAAiD,IAAjD;AACA,eAAKtC,IAAL,CAAUuC,IAAV,CAAe3E,MAAM,CAAC8C,SAAP,CAAiB8B,cAAhC,EAAgD,IAAhD;AACD;;AAEOf,QAAAA,YAAY,CAACK,KAAD,EAAoB;AACtC,cAAI,KAAKxD,aAAL,IAAsB,IAAtB,IAA8B,CAAC,KAAKE,aAAxC,EAAuD,OADjB,CAEtC;;AACA,cAAMuD,UAAU,GAAG,KAAKzD,aAAL,CAAmB0D,aAAnB,CACjBlF,EAAE,CAACgF,KAAK,CAACG,YAAN,EAAD,EAAuBH,KAAK,CAACI,YAAN,EAAvB,CADe,CAAnB,CAHsC,CAOtC;;;AACA,cAAI,CAAC,KAAKO,gBAAL,GAAwBC,QAAxB,CAAiC7F,EAAE,CAACkF,UAAU,CAAC5B,CAAZ,EAAe4B,UAAU,CAAC3B,CAA1B,CAAnC,CAAL,EAAuE;AACrE;AACD;;AAED,eAAKN,0BAAL,CAAgCiC,UAAhC;AACD;;AAEOJ,QAAAA,WAAW,CAACG,KAAD,EAAoB;AACrC,cAAI,CAAC,KAAKtD,aAAV,EAAyB;;AACzB,cAAI,KAAKF,aAAL,IAAsB,IAA1B,EAAgC;AAC9B;AACA,gBAAMyD,UAAU,GAAG,KAAKzD,aAAL,CAAmB0D,aAAnB,CACjBlF,EAAE,CAACgF,KAAK,CAACG,YAAN,EAAD,EAAuBH,KAAK,CAACI,YAAN,EAAvB,CADe,CAAnB,CAF8B,CAM9B;;;AACA,iBAAKhC,oBAAL,CAA0BrD,EAAE,CAACkF,UAAU,CAAC5B,CAAZ,EAAe4B,UAAU,CAAC3B,CAA1B,CAA5B;AACD;;AAED,cAAI,KAAKlC,YAAL,IAAqB,IAArB,IAA6B,KAAKA,YAAL,CAAkByE,UAAnD,EAA+D;AAC7D,iBAAK7C,0BAAL,CAAgC,KAAK5B,YAAL,CAAkB8B,IAAlB,CAAuBC,aAAvD;AACD;;AAED,cAAI,KAAKpB,mBAAL,IAA4B,KAAKX,YAAL,IAAqB,IAArD,EAA2D;AACzD,iBAAK4B,0BAAL,CAAgC,KAAK3B,cAArC;AACD;;AAED,eAAK6B,IAAL,CAAU6B,MAAV,GAAmB,KAAKpD,aAAxB;AACA,eAAKC,WAAL,GAAmB,KAAnB;AACApC,UAAAA,YAAY,CAAC+F,UAAb,CAAwB,KAAKO,kBAA7B,EAAiD,IAAjD;AACA,eAAK5C,IAAL,CAAUuC,IAAV,CAAe3E,MAAM,CAAC8C,SAAP,CAAiBmC,YAAhC,EAA8C,IAA9C;AACD;;AAEO3C,QAAAA,oBAAoB,CAAC4C,aAAD,EAAsB;AAChD,cAAI,CAAC,KAAKzE,aAAN,IAAuB,CAAC,KAAK0E,kBAAjC,EAAqD;AACrD,cAAMC,SAAS,GAAG,KAAK9E,YAAvB;AACA,eAAKA,YAAL,GAAoB,KAAKG,aAAL,CACjB4E,uBADiB;AAAA;AAAA,gCAEjBC,IAFiB,CAEXC,MAAD,IAAoBA,MAAM,CAACJ,kBAAP,IAA6BI,MAAM,CAACC,UAAP,CAAkBN,aAAlB,CAFrC,CAApB,CAHgD,CAOhD;;AACA,cACE,KAAK9E,gBAAL,IACA,KAAKE,YADL,IAEA,KAAKA,YAAL,CAAkBmF,UAAlB,KAAiC;AAAA;AAAA,gCAAOC,UAAP,CAAkBC,MAHrD,EAIE;AACA,gBAAMC,MAAM,GAAG,KAAKtF,YAAL,CAAkBuF,YAAjC;AACA,gBAAMC,MAAM,GAAG,KAAKxF,YAAL,CAAkB8B,IAAlB,CAAuBC,aAAtC;;AACA,gBAAM0D,UAAU,GAAG,KAAK3F,gBAAL,CAAsB4F,qBAAtB,EAAnB;;AAEA,gBAAMC,SAAS,GAAG,CAChB9G,IAAI,CAAC+G,QAAL,CAAcjH,EAAE,CAAC6G,MAAM,CAACvD,CAAR,EAAWuD,MAAM,CAACtD,CAAlB,CAAhB,EAAsCvD,EAAE,CAAC8G,UAAU,CAACI,IAAZ,EAAkBJ,UAAU,CAACK,IAA7B,CAAxC,CADgB,EAEhBjH,IAAI,CAAC+G,QAAL,CAAcjH,EAAE,CAAC6G,MAAM,CAACvD,CAAR,EAAWuD,MAAM,CAACtD,CAAlB,CAAhB,EAAsCvD,EAAE,CAAC8G,UAAU,CAACI,IAAZ,EAAkBJ,UAAU,CAACM,IAA7B,CAAxC,CAFgB,EAGhBlH,IAAI,CAAC+G,QAAL,CAAcjH,EAAE,CAAC6G,MAAM,CAACvD,CAAR,EAAWuD,MAAM,CAACtD,CAAlB,CAAhB,EAAsCvD,EAAE,CAAC8G,UAAU,CAACO,IAAZ,EAAkBP,UAAU,CAACK,IAA7B,CAAxC,CAHgB,EAIhBjH,IAAI,CAAC+G,QAAL,CAAcjH,EAAE,CAAC6G,MAAM,CAACvD,CAAR,EAAWuD,MAAM,CAACtD,CAAlB,CAAhB,EAAsCvD,EAAE,CAAC8G,UAAU,CAACO,IAAZ,EAAkBP,UAAU,CAACM,IAA7B,CAAxC,CAJgB,CAAlB;;AAOA,gBAAIJ,SAAS,CAACM,IAAV,CAAgBC,IAAD,IAAUA,IAAI,IAAIZ,MAAjC,CAAJ,EAA8C;AAC5C;AACA,mBAAKtF,YAAL,GAAoB,IAApB;AACD;AACF;;AAED,cAAI8E,SAAS,KAAK,KAAK9E,YAAvB,EAAqC;AAAA;;AACnC8E,YAAAA,SAAS,QAAT,YAAAA,SAAS,CAAEtD,YAAX,CAAwB,IAAxB;AACA,gBAAI,yBAAC,KAAKxB,YAAN,aAAC,oBAAmBmG,SAAnB,CAA6B,IAA7B,CAAD,CAAJ,EAAyC,KAAKnG,YAAL,GAAoB,IAApB;AAC1C;AACF;;AAEO4B,QAAAA,0BAA0B,CAACC,QAAD,EAAiB;AACjD,eAAK9B,eAAL,GAAuB8B,QAAvB;AACA,eAAK3B,SAAL,GAAiB,CAAjB;AACA9B,UAAAA,YAAY,CAAC+F,UAAb,CAAwB,KAAKiC,cAA7B,EAA6C,IAA7C;AACA,eAAKtE,IAAL,CAAUuC,IAAV,CAAe3E,MAAM,CAAC8C,SAAP,CAAiB6D,SAAhC,EAA2C,IAA3C;AACD;;AAEO9B,QAAAA,gBAAgB,GAAG;AAAA;;AACzB,cAAI,KAAK1D,MAAL,IAAe,IAAnB,EAAyB,OAAOpC,IAAI,EAAX;AACzBH,UAAAA,IAAI,CAACgI,OAAL,CACE9G,YADF,EAEE,KAAKqB,MAAL,CAAYiB,IAAZ,CAAiByE,WAAjB,EAFF,EAGE,KAAK1F,MAAL,CAAYiB,IAAZ,CAAiB0E,WAAjB,EAHF,EAIE,KAAK3F,MAAL,CAAYiB,IAAZ,CAAiB2E,QAAjB,EAJF;AAMA,cAAMC,KAAK,GAAG,KAAK7F,MAAL,CAAY8F,WAAZ,CAAwBD,KAAtC;AACA,cAAME,MAAM,GAAG,KAAK/F,MAAL,CAAY8F,WAAZ,CAAwBC,MAAvC;AACA,cAAMC,SAAS,GAAGpI,IAAI,CACpB,CAAC,KAAKoC,MAAL,CAAYiG,WAAZ,CAAwB7E,CAAzB,GAA6ByE,KADT,EAEpB,CAAC,KAAK7F,MAAL,CAAYiG,WAAZ,CAAwB5E,CAAzB,GAA6B0E,MAFT,EAGpBF,KAHoB,EAIpBE,MAJoB,CAAtB;AAMA,wCAAK/F,MAAL,CAAYiB,IAAZ,CAAiB6B,MAAjB,2CAAyBoD,cAAzB,CAAwCtH,iBAAxC;AACAnB,UAAAA,IAAI,CAAC0I,QAAL,CAAcvH,iBAAd,EAAiCA,iBAAjC,EAAoDD,YAApD;AACA,iBAAOqH,SAAS,CAACI,aAAV,CAAwBxH,iBAAxB,CAAP;AACD;;AAhVuC,O,UACxB+C,S,GAAY;AAC1B8B,QAAAA,cAAc,EAAE,gBADU;AAE1BK,QAAAA,YAAY,EAAE,gBAFY;AAG1B0B,QAAAA,SAAS,EAAE;AAHe,O;;;;;iBAWP,IAAIa,KAAJ,E;;;;;;;iBAOA,IAAIA,KAAJ,E;;;;;;;iBAOJ,IAAIA,KAAJ,E;;kFAEhB9H,Q;;;;;iBAA+C,I;;+FAE/CA,Q;;;;;iBAAwC,I;;8FAExCA,Q;;;;;iBAAuC,K;;wFAEvCA,Q;;;;;iBAAiC,I;;wEAwBjCA,Q,6dAmBAA,Q","sourcesContent":["import {\n  Camera,\n  Canvas,\n  Component,\n  EventHandler,\n  EventTouch,\n  Intersection2D,\n  Mat4,\n  Node,\n  PolygonCollider2D,\n  rect,\n  UITransform,\n  v2,\n  v3,\n  Vec2,\n  Vec3,\n  _decorator,\n} from \"cc\";\nimport { AS } from \"./ASComponent\";\nimport { UIDrop } from \"./UIDrop\";\nimport { findParentCanvas } from \"./Utils\";\n\nconst { ccclass, property, disallowMultiple, requireComponent } = _decorator;\n\nconst DRAG_SPEED = 200;\nconst matrixCached = new Mat4();\nconst worldMatrixCached = new Mat4();\n\n@ccclass(\"UIDrag\")\n@disallowMultiple\n@requireComponent(UITransform)\nexport class UIDrag extends AS(Component) {\n  static readonly EventType = {\n    DRAG_DID_BEGAN: \"drag-did-began\",\n    DRAG_DID_END: \"drag-did-ended\",\n    DRAG_MOVE: \"drag-move\",\n  };\n\n  @property({\n    type: [EventHandler],\n    tooltip: \"The event handler to be triggered when drag begins.\",\n    displayOrder: 30,\n  })\n  dragDidBeganEvents = new Array<EventHandler>();\n\n  @property({\n    type: [EventHandler],\n    tooltip: \"The event handler to be triggered when drag ends.\",\n    displayOrder: 31,\n  })\n  dragDidEndedEvents = new Array<EventHandler>();\n\n  @property({\n    type: [EventHandler],\n    tooltip: \"The event handler to be triggered when drag target position changes.\",\n    displayOrder: 32,\n  })\n  dragMoveEvents = new Array<EventHandler>();\n\n  @property private _target: UITransform | null = null;\n\n  @property private _enableResetPosition = true;\n\n  @property private _usePolygonCollider = false;\n\n  @property private _interactable = true;\n\n  private _thisUITransform: UITransform | null = null;\n\n  private _targetPosition: Vec3 = v3();\n\n  private _validUIDrop: UIDrop | null | undefined = null;\n\n  private _resetPosition: Vec3 = v3();\n\n  private _lerpTime = 0;\n\n  private _parentCanvas: Canvas | null = null;\n\n  private _canvasCamera: Camera | null = null;\n\n  private _collider: PolygonCollider2D | null = null;\n\n  private _isBeginValid = false;\n\n  private _actualParent: Node | null = null;\n\n  private _isDragging = false;\n\n  @property get interactable() {\n    return this._interactable;\n  }\n\n  @property({ tooltip: \"Enable to reset position on mouse up if not inside a UIDrop.\" })\n  get enableResetPosition() {\n    return this._enableResetPosition;\n  }\n\n  @property({\n    type: UITransform,\n    tooltip:\n      \"The node to use as area for dragging. This drag will be limited to the bounds of the \" +\n      \"target node. NOTE: Do not use a parent (or grandparents) of this drag as target!\",\n  })\n  get target(): UITransform | null {\n    return this._target;\n  }\n\n  @property get usePolygonCollider() {\n    return this._usePolygonCollider;\n  }\n\n  get targetPosition() {\n    return this._targetPosition;\n  }\n\n  get resetScreenPoint() {\n    return this._resetPosition;\n  }\n\n  get validUIDrop() {\n    return this.checkUIDrop();\n  }\n\n  set interactable(value) {\n    if (this._interactable === value) return;\n    this._interactable = value;\n\n    if (this._interactable) this._addInputListeners();\n    else this._removeInputListeners();\n  }\n\n  set enableResetPosition(value) {\n    this._enableResetPosition = value;\n  }\n\n  set target(value: UITransform | null) {\n    this._target = value;\n  }\n\n  set usePolygonCollider(value) {\n    this._usePolygonCollider = value;\n  }\n\n  set targetPosition(value: Vec3) {\n    this._lerpTime = 0;\n    this._targetPosition = value;\n\n    this._validUIDrop?.__removeDrag(this);\n    this._validUIDrop = null;\n  }\n\n  set resetScreenPoint(value: Vec3) {\n    this._resetPosition = value;\n  }\n\n  reset() {\n    if (this._resetPosition) {\n      this.forceSetPosition(this._resetPosition);\n    }\n\n    this._validUIDrop?.__removeDrag(this);\n    this._validUIDrop = null;\n  }\n\n  resetDrop() {\n    this._validUIDrop?.__removeDrag(this);\n    this._validUIDrop = null;\n    if (this._resetPosition) {\n      this._setTargetPositionInternal(this._resetPosition);\n    }\n  }\n\n  forceSetPosition(position: Vec3) {\n    if (position == null) return;\n    this._targetPosition = position;\n    this.node.worldPosition = position;\n    this._validUIDrop?.__removeDrag(this);\n    this._validUIDrop = null;\n  }\n\n  checkUIDrop() {\n    this._checkUIDropInternal(v2(this.targetPosition.x, this.targetPosition.y));\n\n    // If valid UI Drop doesn't allow multiple drag's in them, reset.\n\n    return this._validUIDrop;\n  }\n\n  onLoad() {\n    this._thisUITransform = this.getComponent(UITransform);\n    this._parentCanvas = findParentCanvas(this.node);\n    if (this._parentCanvas == null) return;\n    this._canvasCamera = this._parentCanvas.cameraComponent;\n    if (this.target == null) {\n      this.target = this._parentCanvas.getComponent(UITransform);\n    }\n    this._collider = this.getComponent(PolygonCollider2D);\n  }\n\n  onEnable() {\n    if (this._interactable) this._addInputListeners();\n    this.node.on(Node.EventType.PARENT_CHANGED, this._onParentChanged, this);\n    this._onParentChanged();\n  }\n\n  onDisable() {\n    this._removeInputListeners();\n    this.node.off(Node.EventType.PARENT_CHANGED, this._onParentChanged, this);\n  }\n\n  update(dt: number) {\n    const currPosition = this.node.worldPosition;\n    if (Vec3.equals(currPosition, this._targetPosition)) return;\n    this._lerpTime += DRAG_SPEED * dt;\n    if (this._lerpTime > 1) this._lerpTime = 1;\n    this.node.worldPosition = currPosition.lerp(this._targetPosition, this._lerpTime);\n  }\n\n  awake() {\n    // At awake set the target to current position.\n    this._targetPosition = this.node.worldPosition.clone();\n    this._resetPosition = this.node.worldPosition.clone();\n  }\n\n  private _addInputListeners() {\n    this.node.on(Node.EventType.TOUCH_START, this._onTouchStart, this);\n    this.node.on(Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n    this.node.on(Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    this.node.on(Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\n  }\n\n  private _removeInputListeners() {\n    this.node.off(Node.EventType.TOUCH_START, this._onTouchStart, this);\n    this.node.off(Node.EventType.TOUCH_MOVE, this._onTouchMove, this);\n    this.node.off(Node.EventType.TOUCH_END, this._onTouchEnd, this);\n    this.node.off(Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\n  }\n\n  private _onParentChanged() {\n    if (this._isDragging) return;\n    this._actualParent = this.node.parent;\n  }\n\n  private _onTouchStart(event: EventTouch) {\n    if (this._canvasCamera == null || this._parentCanvas == null) return;\n    const mouseWorld = this._canvasCamera.screenToWorld(\n      v3(event.getLocationX(), event.getLocationY()),\n    );\n    if (this._usePolygonCollider && this._collider) {\n      this._isBeginValid = Intersection2D.pointInPolygon(\n        v2(mouseWorld.x, mouseWorld.y),\n        this._collider.worldPoints,\n      );\n    } else {\n      this._isBeginValid = true;\n    }\n\n    this._isDragging = true;\n    this.node.parent = this._parentCanvas.node;\n    EventHandler.emitEvents(this.dragDidBeganEvents, this);\n    this.node.emit(UIDrag.EventType.DRAG_DID_BEGAN, this);\n  }\n\n  private _onTouchMove(event: EventTouch) {\n    if (this._canvasCamera == null || !this._isBeginValid) return;\n    // Convert mouse location from screen to world coords.\n    const mouseWorld = this._canvasCamera.screenToWorld(\n      v3(event.getLocationX(), event.getLocationY()),\n    );\n\n    // If outside target stop move.\n    if (!this._getTargetBounds().contains(v2(mouseWorld.x, mouseWorld.y))) {\n      return;\n    }\n\n    this._setTargetPositionInternal(mouseWorld);\n  }\n\n  private _onTouchEnd(event: EventTouch) {\n    if (!this._isBeginValid) return;\n    if (this._canvasCamera != null) {\n      // Convert mouse location from screen to world coords.\n      const mouseWorld = this._canvasCamera.screenToWorld(\n        v3(event.getLocationX(), event.getLocationY()),\n      );\n\n      // Check to see if inside any valid uidrop under target.\n      this._checkUIDropInternal(v2(mouseWorld.x, mouseWorld.y));\n    }\n\n    if (this._validUIDrop != null && this._validUIDrop.enableSnap) {\n      this._setTargetPositionInternal(this._validUIDrop.node.worldPosition);\n    }\n\n    if (this.enableResetPosition && this._validUIDrop == null) {\n      this._setTargetPositionInternal(this._resetPosition);\n    }\n\n    this.node.parent = this._actualParent;\n    this._isDragging = false;\n    EventHandler.emitEvents(this.dragDidEndedEvents, this);\n    this.node.emit(UIDrag.EventType.DRAG_DID_END, this);\n  }\n\n  private _checkUIDropInternal(touchLocation: Vec2) {\n    if (!this._parentCanvas || !this.enabledInHierarchy) return;\n    const oldUIDrop = this._validUIDrop;\n    this._validUIDrop = this._parentCanvas\n      .getComponentsInChildren(UIDrop)\n      .find((uiDrop: UIDrop) => uiDrop.enabledInHierarchy && uiDrop.__isInside(touchLocation));\n\n    // Check and see if valid if drop is circle type.\n    if (\n      this._thisUITransform &&\n      this._validUIDrop &&\n      this._validUIDrop.boundsType === UIDrop.BoundsType.CIRCLE\n    ) {\n      const radius = this._validUIDrop.circleRadius;\n      const center = this._validUIDrop.node.worldPosition;\n      const dragBounds = this._thisUITransform.getBoundingBoxToWorld();\n\n      const distances = [\n        Vec2.distance(v2(center.x, center.y), v2(dragBounds.xMin, dragBounds.yMin)),\n        Vec2.distance(v2(center.x, center.y), v2(dragBounds.xMin, dragBounds.yMax)),\n        Vec2.distance(v2(center.x, center.y), v2(dragBounds.xMax, dragBounds.yMin)),\n        Vec2.distance(v2(center.x, center.y), v2(dragBounds.xMax, dragBounds.yMax)),\n      ];\n\n      if (distances.some((curr) => curr >= radius)) {\n        // If any corner outside the circle radius set as invalid.\n        this._validUIDrop = null;\n      }\n    }\n\n    if (oldUIDrop !== this._validUIDrop) {\n      oldUIDrop?.__removeDrag(this);\n      if (!this._validUIDrop?.__addDrag(this)) this._validUIDrop = null;\n    }\n  }\n\n  private _setTargetPositionInternal(position: Vec3) {\n    this._targetPosition = position;\n    this._lerpTime = 0;\n    EventHandler.emitEvents(this.dragMoveEvents, this);\n    this.node.emit(UIDrag.EventType.DRAG_MOVE, this);\n  }\n\n  private _getTargetBounds() {\n    if (this.target == null) return rect();\n    Mat4.fromRTS(\n      matrixCached,\n      this.target.node.getRotation(),\n      this.target.node.getPosition(),\n      this.target.node.getScale(),\n    );\n    const width = this.target.contentSize.width;\n    const height = this.target.contentSize.height;\n    const localRect = rect(\n      -this.target.anchorPoint.x * width,\n      -this.target.anchorPoint.y * height,\n      width,\n      height,\n    );\n    this.target.node.parent?.getWorldMatrix(worldMatrixCached);\n    Mat4.multiply(worldMatrixCached, worldMatrixCached, matrixCached);\n    return localRect.transformMat4(worldMatrixCached);\n  }\n}\n"]}