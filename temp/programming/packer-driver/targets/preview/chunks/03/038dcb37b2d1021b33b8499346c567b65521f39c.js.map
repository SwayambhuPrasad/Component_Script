{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/assets/Storypanel/StoryPanel.ts"],"names":["Button","Component","instantiate","Node","UIOpacity","Vec3","_decorator","AS","UIDrag","UIView","ccclass","property","StoryPanel","type","_filled","_dragNodes","_pageNumber","_draggables","_stateManager","_panelPosition","awake","_arrangeDraggable","_addComponent","stateManager","forEach","d","push","active","panel","addComponent","on","EventType","CLICK","_onButtonClick","i","drag","DragContainer","children","node","DRAG_DID_END","_DragEnd","length","Arrows","popup","getComponentsInChildren","Arrow","_arrowNavigator","n","SHOW_COMPLETE","_pageNavigation","ABOUT_TO_HIDE","_onpopuphide","Index","slot","validUIDrop","destroyAllChildren","dragCopy","dragsInside","getComponent","destroy","parent","name","worldPosition","console","log","replacedNode","opacity","interactable","offsetx","position","x","offsety","y","gridPositions","gridSelector","numberOfElementPerpage","close","hide","setPosition","show","draggable","pageNumber","pageGrouping","j","direction"],"mappings":"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","sourcesContent":["import { Button, Component, instantiate, Node, UIOpacity, Vec3, _decorator } from \"cc\";\nimport { AS, UIDrag, UIView } from \"db://as_framework/scripts\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"StoryPanel\")\nexport class StoryPanel extends AS(Component) {\n  // @property({ type: SpriteFrame }) panelSlots: SpriteFrame[] = [];\n  @property({ type: Node }) panel: Node = null;\n\n  @property({ type: UIView }) popup: UIView | null = null;\n\n  @property({ type: Node }) DragContainer: Node = null;\n\n  @property numberOfElementPerpage: number = 4;\n\n  private _filled = [];\n  private _dragNodes = [];\n  private _pageNumber = 0;\n  private _draggables: UIDrag[] = [];\n  private _stateManager = [];\n  private _panelPosition = new Vec3(0, 0, 0);\n\n  awake() {\n    this._arrangeDraggable();\n    this._addComponent();\n  }\n\n  stateManager() {\n    this._dragNodes.forEach((d) => {\n      this._stateManager.push(d.active);\n    });\n  }\n\n  _addComponent() {\n    // for (let i = 0; i < this.panel.children.length - 1; i++) {\n    //   this.panel.children[i].addComponent(UIDrop);\n    // }\n\n    this.panel.addComponent(Button);\n    this.panel.on(Button.EventType.CLICK, this._onButtonClick, this);\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      const drag = this.DragContainer.children[i].addComponent(UIDrag);\n      this.DragContainer.children[i].addComponent(UIOpacity);\n      drag.node.on(UIDrag.EventType.DRAG_DID_END, () => {\n        this._DragEnd(drag, i);\n      });\n\n      this._dragNodes.push(this.DragContainer.children[i]);\n      this._draggables.push(drag);\n    }\n\n    let Arrows = this.popup.node.getComponentsInChildren(Button);\n    Arrows.forEach((Arrow, i) => {\n      Arrow.node.on(\n        Button.EventType.CLICK,\n        () => {\n          this._arrowNavigator(i);\n        },\n        this,\n      );\n    });\n\n    this._dragNodes.forEach((n) => (n.active = false));\n\n    this.popup.node.on(UIView.EventType.SHOW_COMPLETE, () => {\n      this._dragNodes.forEach((n) => (n.active = true));\n      this._pageNavigation(0);\n    });\n    this.popup.node.on(UIView.EventType.ABOUT_TO_HIDE, this._onpopuphide, this);\n  }\n  _DragEnd(drag, Index) {\n    const slot = drag.validUIDrop;\n    if (slot == null) return;\n    slot.node.destroyAllChildren();\n    const dragCopy = instantiate(slot.dragsInside[0].node);\n    dragCopy.getComponent(UIDrag).destroy();\n    dragCopy.parent = slot.node;\n    dragCopy.name = slot.node.name;\n    dragCopy.worldPosition = slot.node.worldPosition;\n    console.log(slot.replacedNode, slot.dragsInside[0], slot);\n    //drag.node.active = false;\n    drag.node.getComponent(UIOpacity).opacity = 0;\n    drag.interactable = false;\n    if (slot.replacedNode.length != 0) {\n      //slot.replacedNode[0].node.active = true;\n      slot.replacedNode[0].node.getComponent(UIOpacity).opacity = 255;\n      slot.replacedNode[0].interactable = true;\n    }\n\n    //drag.node.getComponent(UIDrag).reset();\n    //drag.interactable = false;\n  }\n\n  _arrangeDraggable() {\n    let offsetx = this.panel.position.x - this.popup.node.position.x;\n    let offsety = this.panel.position.y - this.popup.node.position.y;\n    console.log(\"offset\", offsetx, offsety);\n    let gridPositions = [\n      [\n        [-150 - offsetx, 80 - offsety],\n        [150 - offsetx, 80 - offsety],\n        [-150 - offsetx, -120 - offsety],\n        [150 - offsetx, -120 - offsety],\n      ],\n      [\n        [-150 - offsetx, 0 - offsety],\n        [150 - offsetx, 0 - offsety],\n      ],\n      [[0 - offsetx, 0 - offsety]],\n    ];\n    let gridSelector;\n    if (this.numberOfElementPerpage == 2) gridSelector = 1;\n    else if (this.numberOfElementPerpage == 4) gridSelector = 0;\n    else if (this.numberOfElementPerpage == 1) gridSelector = 2;\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      this.DragContainer.children[i].position = new Vec3(\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][0],\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][1],\n        0,\n      );\n    }\n  }\n\n  async close() {\n    await this.popup.hide();\n    console.log(this._panelPosition);\n    this.panel.setPosition(this._panelPosition);\n    this._onpopuphide();\n  }\n  _onButtonClick() {\n    this._panelPosition = this.panel.position;\n    console.log(this._panelPosition);\n    this.panel.position = new Vec3(0, 300, 0);\n    this.popup.show();\n  }\n\n  _onpopuphide() {\n    this._draggables.forEach((draggable, i) => {\n      draggable.node.active = false;\n    });\n  }\n\n  _pageNavigation(pageNumber) {\n    let pageGrouping = [[]];\n    let j = 0;\n    for (let i = 0; i < this._dragNodes.length; i++) {\n      if (i % this.numberOfElementPerpage == 0 && i != 0) {\n        j++;\n        pageGrouping[j] = [];\n        this._stateManager[j] = [];\n      }\n      pageGrouping[j].push(this._dragNodes[i]);\n    }\n\n    for (let i = 0; i < pageGrouping.length; i++)\n      for (let j = 0; j < pageGrouping[i].length; j++) {\n        if (i == pageNumber) {\n          pageGrouping[i][j].active = true;\n          //this._stateManager[i][j].push(true);\n        } else {\n          pageGrouping[i][j].active = false;\n          //this._stateManager[i][j].push(false);\n        }\n      }\n    this.stateManager();\n    console.log(this._stateManager);\n  }\n\n  _arrowNavigator(direction) {\n    if (\n      direction == 1 &&\n      this._dragNodes.length != (this._pageNumber + 1) * this.numberOfElementPerpage\n    )\n      this._pageNumber++;\n    else if (direction == 0 && this._pageNumber != 0) this._pageNumber--;\n\n    this._pageNavigation(this._pageNumber);\n  }\n}\n"]}