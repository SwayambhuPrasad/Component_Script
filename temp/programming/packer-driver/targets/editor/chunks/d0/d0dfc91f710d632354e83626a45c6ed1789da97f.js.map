{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/assets/Storypanel/StoryPanel.ts"],"names":["Button","Component","Node","Vec3","_decorator","AS","UIDrag","UIDrop","UIPopup","ccclass","property","StoryPanel","type","_filled","_dragOptions","_pageNumber","awake","_arrangeDraggable","_addComponent","i","panel","children","length","addComponent","on","EventType","CLICK","_onButtonClick","DragContainer","push","Arrows","popup","node","getComponentsInChildren","forEach","Arrow","_arrowNavigator","ABOUT_TO_HIDE","_onpopuphide","gridPositions","gridSelector","numberOfElementPerpage","position","show","_pageNavigation","validDrop","draggable","getComponent","validUIDrop","pageNumber","pageGrouping","j","active","console","log","direction"],"mappings":"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","sourcesContent":["import { Button, Component, Node, Vec3, _decorator } from \"cc\";\nimport { AS, UIDrag, UIDrop, UIPopup } from \"db://as_framework/scripts\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"StoryPanel\")\nexport class StoryPanel extends AS(Component) {\n  // @property({ type: SpriteFrame }) panelSlots: SpriteFrame[] = [];\n  @property({ type: Node }) panel: Node = null;\n  @property({ type: UIPopup }) popup: UIPopup | null = null;\n  @property({ type: Node }) DragContainer: Node = null;\n  @property numberOfElementPerpage: number = 4;\n\n  private _filled = [];\n  private _dragOptions = [];\n  private _pageNumber = 0;\n\n  awake() {\n    this._arrangeDraggable();\n    this._addComponent();\n  }\n\n  _addComponent() {\n    for (let i = 0; i < this.panel.children.length; i++) {\n      this.panel.children[i].addComponent(UIDrop);\n    }\n\n    this.panel.addComponent(Button);\n    this.panel.on(Button.EventType.CLICK, this._onButtonClick, this);\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      this.DragContainer.children[i].addComponent(UIDrag);\n      this._dragOptions.push(this.DragContainer.children[i]);\n    }\n    let Arrows = this.popup.node.getComponentsInChildren(Button);\n    Arrows.forEach((Arrow, i) => {\n      Arrow.node.on(\n        Button.EventType.CLICK,\n        () => {\n          this._arrowNavigator(i);\n        },\n        this,\n      );\n    });\n\n    this.popup.node.on(UIPopup.EventType.ABOUT_TO_HIDE, this._onpopuphide, this);\n  }\n\n  _arrangeDraggable() {\n    let gridPositions = [\n      [\n        [-150, 80],\n        [150, 80],\n        [-150, -120],\n        [150, -120],\n      ],\n      [\n        [-150, 0],\n        [150, 0],\n      ],\n      [0, 0],\n    ];\n    let gridSelector;\n    if (this.numberOfElementPerpage == 2) gridSelector = 1;\n    else if (this.numberOfElementPerpage == 4) gridSelector = 0;\n    else if (this.numberOfElementPerpage == 1) gridSelector = 2;\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      this.DragContainer.children[i].position = new Vec3(\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][0],\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][1],\n        0,\n      );\n    }\n  }\n\n  _onButtonClick() {\n    this.popup.show();\n    this._pageNavigation(0);\n  }\n\n  _onpopuphide() {\n    var validDrop = [];\n    this._dragOptions.forEach((draggable, i) => {\n      validDrop.push(draggable.getComponent(UIDrag).validUIDrop);\n    });\n  }\n\n  _pageNavigation(pageNumber) {\n    let pageGrouping = [[]];\n    let j = 0;\n    for (let i = 0; i < this._dragOptions.length; i++) {\n      if (i % this.numberOfElementPerpage == 0 && i != 0) {\n        j++;\n        pageGrouping[j] = [];\n      }\n      pageGrouping[j].push(this._dragOptions[i]);\n    }\n\n    for (let i = 0; i < pageGrouping.length; i++)\n      for (let j = 0; j < pageGrouping[i].length; j++) {\n        if (i == pageNumber) {\n          pageGrouping[i][j].active = true;\n          console.log(i);\n        } else pageGrouping[i][j].active = false;\n      }\n  }\n\n  _arrowNavigator(direction) {\n    if (\n      direction == 1 &&\n      this._dragOptions.length != (this._pageNumber + 1) * this.numberOfElementPerpage\n    )\n      this._pageNumber++;\n    else if (direction == 0 && this._pageNumber != 0) this._pageNumber--;\n\n    this._pageNavigation(this._pageNumber);\n  }\n}\n"]}