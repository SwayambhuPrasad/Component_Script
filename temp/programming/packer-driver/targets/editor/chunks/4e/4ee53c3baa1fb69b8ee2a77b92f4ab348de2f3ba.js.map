{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/extensions/as_framework/framework/assets/scripts/OptionButton.ts"],"names":["Button","Component","Director","director","EventHandler","instantiate","Label","Layout","Node","Sprite","UITransform","v3","_decorator","AS","error","OptionData","OptionItem","UIPopup","ccclass","property","requireComponent","OptionButton","type","tooltip","displayOrder","_uiTransform","_popupUITransform","_selectedIndex","buttonLabel","_buttonLabel","buttonSprite","_buttonSprite","popup","_popup","optionsContainer","_optionsContainer","optionItemTemplate","_optionItemTemplate","hideOnSelected","_hideOnSelected","matchPopupWidth","_matchPopupWidth","optionDatas","_optionDatas","selectedIndex","options","value","length","_updateButton","hideOptions","reset","showOptions","show","hide","onLoad","getComponent","node","on","EventType","HIDE_COMPLETE","_destroyOptionList","ABOUT_TO_SHOW","_createOptionsList","updateLayout","once","EVENT_AFTER_UPDATE","_updatePopupPosition","parent","onEnable","CLICK","_onClick","onDisable","off","onDestroy","destroy","isVisible","width","height","_uiProps","uiTransformComp","buttonWorldBounds","getBoundingBoxToWorld","canvasBounds","_parentCanvas","getBoundingBox","anchorX","anchorY","popupWorldPosY","yMin","yMax","setAnchorPoint","setWorldPosition","worldPosition","x","children","forEach","item","active","string","enabled","data","spriteFrame","index","itemNode","itemUITransform","label","sprite","setClickCallback","_itemClickCallback","bind","addChild","itemIndex","emitEvents","optionChangedEvents","emit","OPTION_CHANGED","Array"],"mappings":"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","sourcesContent":["import {\n  Button,\n  Component,\n  Director,\n  director,\n  EventHandler,\n  instantiate,\n  Label,\n  Layout,\n  Node,\n  Sprite,\n  UITransform,\n  v3,\n  _decorator,\n} from \"cc\";\nimport { AS } from \"./ASComponent\";\nimport { error } from \"./Logger\";\nimport { OptionData } from \"./OptionData\";\nimport { OptionItem } from \"./OptionItem\";\nimport { UIPopup } from \"./UIPopup\";\n\nconst { ccclass, property, requireComponent } = _decorator;\n\n@ccclass(\"OptionButton\")\n@requireComponent(UITransform)\n@requireComponent(Button)\nexport class OptionButton extends AS(Component) {\n  static readonly EventType = { OPTION_CHANGED: \"option-changed\" };\n\n  @property({\n    type: [EventHandler],\n    tooltip: \"The event handler to be triggered when selected option is changed.\",\n    displayOrder: 30,\n  })\n  optionChangedEvents = new Array<EventHandler>();\n\n  @property private _buttonLabel: Label | null = null;\n\n  @property private _buttonSprite: Sprite | null = null;\n\n  @property private _popup: UIPopup | null = null;\n\n  @property private _optionsContainer: Layout | null = null;\n\n  @property private _optionItemTemplate: Node | null = null;\n\n  @property private _hideOnSelected = true;\n\n  @property private _matchPopupWidth = true;\n\n  @property private _optionDatas = new Array<OptionData>();\n\n  private _uiTransform: UITransform | null = null;\n\n  private _popupUITransform: UITransform | null = null;\n\n  private _selectedIndex = -1;\n\n  /**\n   * The label to show the selected option text.\n   */\n  @property({\n    type: Label,\n    tooltip: \"The label to show the selected option text.\",\n  })\n  get buttonLabel() {\n    return this._buttonLabel;\n  }\n\n  @property({\n    type: Sprite,\n    tooltip: \"The sprite to show the selected option spriteFrame.\",\n  })\n  get buttonSprite() {\n    return this._buttonSprite;\n  }\n\n  @property({\n    type: UIPopup,\n    tooltip: \"The node used as popup.\",\n  })\n  get popup() {\n    return this._popup;\n  }\n\n  @property({\n    type: Layout,\n    tooltip: \"The layout used as a parent for the option items.\",\n  })\n  get optionsContainer() {\n    return this._optionsContainer;\n  }\n\n  @property({\n    type: Node,\n    tooltip: \"The template used for each option item.\",\n  })\n  get optionItemTemplate() {\n    return this._optionItemTemplate;\n  }\n\n  @property({\n    tooltip: \"Set to true if you want to hide the drop down on option selected.\",\n  })\n  get hideOnSelected() {\n    return this._hideOnSelected;\n  }\n\n  @property({ tooltip: `If true ensures popup width is same as button width.` })\n  get matchPopupWidth() {\n    return this._matchPopupWidth;\n  }\n\n  @property({\n    type: [OptionData],\n    tooltip: \"Array of string and spriteframe data for each option.\",\n  })\n  get optionDatas() {\n    return this._optionDatas;\n  }\n\n  /**\n   * The selected option index or `-1` if no option is selected.\n   * If invalid value is set it defaults to `-1`.\n   */\n  get selectedIndex() {\n    return this._selectedIndex;\n  }\n\n  /**\n   * The list of options used in the drop box.\n   */\n  get options() {\n    return this._optionDatas;\n  }\n\n  set buttonLabel(value) {\n    this._buttonLabel = value;\n  }\n\n  set buttonSprite(value) {\n    this._buttonSprite = value;\n  }\n\n  set popup(value) {\n    this._popup = value;\n  }\n\n  set optionsContainer(value) {\n    this._optionsContainer = value;\n  }\n\n  set optionItemTemplate(value) {\n    this._optionItemTemplate = value;\n  }\n\n  set hideOnSelected(value) {\n    this._hideOnSelected = value;\n  }\n\n  set matchPopupWidth(value) {\n    this._matchPopupWidth = value;\n  }\n\n  set optionDatas(value) {\n    this._optionDatas = value;\n  }\n\n  set selectedIndex(value: number) {\n    if (this._selectedIndex !== value) {\n      if (value < 0 || value > this.optionDatas.length) {\n        this._selectedIndex = -1;\n      } else {\n        this._selectedIndex = value;\n      }\n      this._updateButton();\n    }\n    if (this.hideOnSelected) this.hideOptions();\n  }\n\n  set options(value: OptionData[]) {\n    this._optionDatas = value;\n  }\n\n  /**\n   * Clear the selected index and hide the drop box.\n   */\n  reset() {\n    this.selectedIndex = -1;\n    this._updateButton();\n    this.hideOptions();\n  }\n\n  /**\n   * Manually show the options popup.\n   */\n  showOptions() {\n    this.popup?.show();\n  }\n\n  /**\n   * Manually hide the options popup.\n   */\n  hideOptions() {\n    this.popup?.hide();\n  }\n\n  onLoad() {\n    if (this.popup == null) {\n      error(`The popup cannot be null`);\n      return;\n    }\n    if (this.optionItemTemplate == null) {\n      error(`The option item template must be a valid node.`);\n      return;\n    }\n    if (this.optionsContainer == null) {\n      error(`The options container cannot be null.`);\n      return;\n    }\n\n    this._uiTransform = this.getComponent(UITransform);\n    this._popupUITransform = this.popup.getComponent(UITransform);\n\n    this.popup.node.on(UIPopup.EventType.HIDE_COMPLETE, this._destroyOptionList, this);\n\n    this.popup.node.on(\n      UIPopup.EventType.ABOUT_TO_SHOW,\n      () => {\n        this._destroyOptionList();\n        this._createOptionsList();\n        this.optionsContainer!.updateLayout();\n        director.once(Director.EVENT_AFTER_UPDATE, this._updatePopupPosition, this);\n      },\n      this,\n    );\n\n    // unparent the item template.\n    this.optionItemTemplate.parent = null;\n\n    this._updateButton();\n  }\n\n  onEnable() {\n    this.node.on(Button.EventType.CLICK, this._onClick, this);\n  }\n\n  onDisable() {\n    this.node.off(Button.EventType.CLICK, this._onClick, this);\n  }\n\n  onDestroy() {\n    // Ensure the hanging nodes are destroyed to prevent leaks.\n    this.optionItemTemplate?.destroy();\n  }\n\n  private _onClick() {\n    if (!this.popup) return;\n    if (!this.popup.isVisible) {\n      this.showOptions();\n    } else {\n      this.hideOptions();\n    }\n  }\n\n  private _updatePopupPosition() {\n    if (\n      this.popup == null ||\n      this._popupUITransform == null ||\n      this._uiTransform == null ||\n      this.optionsContainer == null\n    ) {\n      error(\"Unable to create options list\");\n      return;\n    }\n    if (this._matchPopupWidth) this._popupUITransform.width = this._uiTransform.width;\n    if (this._popupUITransform.height === 0) {\n      this._popupUITransform.height = this.optionsContainer.node._uiProps.uiTransformComp!.height;\n    }\n    const buttonWorldBounds = this._uiTransform.getBoundingBoxToWorld();\n    const canvasBounds = this.popup._parentCanvas!.node._uiProps.uiTransformComp!.getBoundingBox();\n    // Initially set anchor to top center.\n    let anchorX = 0.5;\n    let anchorY = 1.0;\n    // Set the position Y as below the button box bounds.\n    let popupWorldPosY = buttonWorldBounds.yMin;\n    // Check if popupPositionY provides enough room for the entire popup to\n    // be visible at the bottom.\n    // If not place above the edit box.\n    if (popupWorldPosY - this._popupUITransform.height < canvasBounds.yMin) {\n      // Set the anchor to the bottom.\n      anchorY = 0.0;\n      popupWorldPosY = buttonWorldBounds.yMax;\n    }\n    this._popupUITransform.setAnchorPoint(anchorX, anchorY);\n    this.popup.node.setWorldPosition(v3(this.node.worldPosition.x, popupWorldPosY));\n  }\n\n  private _destroyOptionList() {\n    this.optionsContainer?.node.children.forEach((item) => item.destroy());\n  }\n\n  private _updateButton() {\n    if (!this.node.active) return;\n    if (this.optionDatas.length <= 0 || this.selectedIndex < 0) {\n      if (this.buttonLabel) {\n        this.buttonLabel.string = \"\";\n        this.buttonLabel.enabled = false;\n      }\n    } else {\n      const data = this.optionDatas[this.selectedIndex];\n      if (this.buttonLabel) {\n        this.buttonLabel.string = data.string;\n        this.buttonLabel.enabled = !!data.string;\n      }\n\n      if (this.buttonSprite) {\n        this.buttonSprite.spriteFrame = data.spriteFrame;\n        this.buttonSprite.enabled = !!data.spriteFrame;\n      }\n    }\n  }\n\n  private _createOptionsList() {\n    if (\n      this.optionItemTemplate == null ||\n      this._uiTransform == null ||\n      this.optionsContainer == null\n    ) {\n      error(\"Unable to create options list\");\n      return;\n    }\n    for (let index = 0; index < this.optionDatas.length; index++) {\n      const data = this.optionDatas[index];\n      const itemNode = instantiate(this.optionItemTemplate);\n      const itemUITransform = itemNode.getComponent(UITransform);\n      if (itemUITransform == null) {\n        error(\"The option item template does not have a UITransform Component.\");\n        return;\n      }\n      itemUITransform.height = this._uiTransform.height;\n      const item = itemNode.getComponent(OptionItem);\n      if (item == null) {\n        error(\"The option item template does not have a OptionItem Component.\");\n        return;\n      }\n\n      if (item.label) {\n        item.label.string = data.string;\n        item.label.enabled = !!data.string;\n      }\n\n      if (item.sprite) {\n        item.sprite.spriteFrame = data.spriteFrame;\n        item.sprite.enabled = !!data.spriteFrame;\n      }\n\n      item.setClickCallback(this._itemClickCallback.bind(this, index));\n\n      this.optionsContainer.node.addChild(itemNode);\n    }\n  }\n\n  private _itemClickCallback(itemIndex: number) {\n    if (this.selectedIndex !== itemIndex) {\n      this.selectedIndex = itemIndex;\n      // Emit the option changed event.\n      EventHandler.emitEvents(this.optionChangedEvents, this);\n      this.node.emit(OptionButton.EventType.OPTION_CHANGED, this);\n    }\n  }\n}\n"]}