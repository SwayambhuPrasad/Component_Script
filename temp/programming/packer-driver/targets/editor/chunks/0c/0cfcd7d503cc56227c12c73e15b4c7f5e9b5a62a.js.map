{"version":3,"sources":["file:///Users/swayambhupanda/Documents/GitHub/applet-framework-demo/assets/Storypanel/StoryPanel.ts"],"names":["Button","Component","instantiate","Node","Vec3","_decorator","AS","UIDrag","UIDrop","UIView","ccclass","property","StoryPanel","type","_filled","_dragNodes","_pageNumber","_draggables","awake","_arrangeDraggable","_addComponent","update","i","panel","children","length","addComponent","on","EventType","CLICK","_onButtonClick","DragContainer","drag","node","DRAG_DID_END","validUIDrop","slot","destroyAllChildren","dragCopy","getComponent","destroy","parent","worldPosition","console","log","name","interactable","push","Arrows","popup","getComponentsInChildren","forEach","Arrow","_arrowNavigator","n","active","SHOW_COMPLETE","_pageNavigation","ABOUT_TO_HIDE","_onpopuphide","offsetx","position","x","offsety","y","gridPositions","gridSelector","numberOfElementPerpage","show","draggable","pageNumber","pageGrouping","j","direction"],"mappings":"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","sourcesContent":["import { Button, Component, instantiate, Node, Vec3, _decorator } from \"cc\";\nimport { AS, UIDrag, UIDrop, UIView } from \"db://as_framework/scripts\";\nconst { ccclass, property } = _decorator;\n\n@ccclass(\"StoryPanel\")\nexport class StoryPanel extends AS(Component) {\n  // @property({ type: SpriteFrame }) panelSlots: SpriteFrame[] = [];\n  @property({ type: Node }) panel: Node = null;\n\n  @property({ type: UIView }) popup: UIView | null = null;\n\n  @property({ type: Node }) DragContainer: Node = null;\n\n  @property numberOfElementPerpage: number = 4;\n\n  private _filled = [];\n  private _dragNodes = [];\n  private _pageNumber = 0;\n  private _draggables: UIDrag[] = [];\n\n  awake() {\n    this._arrangeDraggable();\n    this._addComponent();\n  }\n\n  update() {\n    // this._draggables.forEach(drag=>drag.interactable = ())\n  }\n\n  _addComponent() {\n    for (let i = 0; i < this.panel.children.length; i++) {\n      this.panel.children[i].addComponent(UIDrop);\n    }\n\n    this.panel.addComponent(Button);\n    this.panel.on(Button.EventType.CLICK, this._onButtonClick, this);\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      const drag = this.DragContainer.children[i].addComponent(UIDrag);\n      drag.node.on(UIDrag.EventType.DRAG_DID_END, () => {\n        if (drag.validUIDrop == null) return;\n\n        const slot = drag.validUIDrop;\n        slot.node.destroyAllChildren();\n        const dragCopy = instantiate(drag.node);\n        dragCopy.getComponent(UIDrag).destroy();\n        dragCopy.parent = slot.node;\n        dragCopy.worldPosition = slot.node.worldPosition;\n        console.log(\"copyPosition\", dragCopy.worldPosition)\n        console.log(\"slotPosition\", slot.node.worldPosition)\n        console.log(\"slotname\", slot.node.name)\n        drag.interactable = false;\n      });\n      this._dragNodes.push(this.DragContainer.children[i]);\n      this._draggables.push(drag);\n    }\n\n    let Arrows = this.popup.node.getComponentsInChildren(Button);\n    Arrows.forEach((Arrow, i) => {\n      Arrow.node.on(\n        Button.EventType.CLICK,\n        () => {\n          this._arrowNavigator(i);\n        },\n        this,\n      );\n    });\n\n    this._dragNodes.forEach((n) => (n.active = false));\n\n    this.popup.node.on(UIView.EventType.SHOW_COMPLETE, () => {\n      this._dragNodes.forEach((n) => (n.active = true));\n      this._pageNavigation(0);\n    });\n    this.popup.node.on(UIView.EventType.ABOUT_TO_HIDE, this._onpopuphide, this);\n  }\n\n  _arrangeDraggable() {\n    let offsetx = this.panel.position.x - this.popup.node.position.x;\n    let offsety = this.panel.position.y - this.popup.node.position.y;\n    console.log(\"offset\",offsetx,offsety);\n    let gridPositions = [\n      [\n        [-150 - offsetx, 80 - offsety],\n        [150 - offsetx, 80 - offsety],\n        [-150 - offsetx, -120 - offsety],\n        [150 - offsetx, -120 - offsety],\n      ],\n      [\n        [-150 - offsetx, 0 - offsety],\n        [150 - offsetx, 0 - offsety],\n      ],\n      [[0 - offsetx,0 - offsety]],\n    ];\n    let gridSelector;\n    if (this.numberOfElementPerpage == 2) gridSelector = 1;\n    else if (this.numberOfElementPerpage == 4) gridSelector = 0;\n    else if (this.numberOfElementPerpage == 1) gridSelector = 2;\n\n    for (let i = 0; i < this.DragContainer.children.length; i++) {\n      this.DragContainer.children[i].position = new Vec3(\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][0],\n        gridPositions[gridSelector][i % this.numberOfElementPerpage][1],\n        0,\n      );\n    }\n  }\n\n  _onButtonClick() {\n    this.panel.position=new Vec3(0,300,0)\n    this.popup.show();\n  }\n\n  _onpopuphide() {\n    this._draggables.forEach((draggable, i) => {\n      draggable.node.active = false;\n    });\n  }\n\n  _pageNavigation(pageNumber) {\n    let pageGrouping = [[]];\n    let j = 0;\n    for (let i = 0; i < this._dragNodes.length; i++) {\n      if (i % this.numberOfElementPerpage == 0 && i != 0) {\n        j++;\n        pageGrouping[j] = [];\n      }\n      pageGrouping[j].push(this._dragNodes[i]);\n    }\n\n    for (let i = 0; i < pageGrouping.length; i++)\n      for (let j = 0; j < pageGrouping[i].length; j++) {\n        if (i == pageNumber) {\n          pageGrouping[i][j].active = true;\n          console.log(i);\n        } else pageGrouping[i][j].active = false;\n      }\n  }\n\n  _arrowNavigator(direction) {\n    if (\n      direction == 1 &&\n      this._dragNodes.length != (this._pageNumber + 1) * this.numberOfElementPerpage\n    )\n      this._pageNumber++;\n    else if (direction == 0 && this._pageNumber != 0) this._pageNumber--;\n\n    this._pageNavigation(this._pageNumber);\n  }\n}\n"]}